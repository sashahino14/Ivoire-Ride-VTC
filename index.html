<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ivoire Ride - Simulation VTC Côte d'Ivoire</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        :root {
            --primary: #FF8C00;
            --primary-dark: #E67E00;
            --secondary: #1A2A6C;
            --accent: #28A745;
        }
        
        body {
            background: linear-gradient(135deg, #f8f9fa, #e9ecef);
            font-family: 'Segoe UI', system-ui, sans-serif;
        }
        
        #map {
            height: 400px;
            width: 100%;
            border-radius: 1rem;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.1);
            z-index: 0;
        }
        
        .vehicle-marker {
            background-color: var(--primary);
            border-radius: 50%;
            width: 24px;
            height: 24px;
            display: flex;
            justify-content: center;
            align-items: center;
            color: white;
            font-size: 12px;
            box-shadow: 0 0 10px rgba(0,0,0,0.5);
            border: 2px solid white;
        }
        
        .route-animation {
            stroke-dasharray: 1000;
            stroke-dashoffset: 1000;
            animation: dash 30s linear forwards;
        }
        
        @keyframes dash {
            to {
                stroke-dashoffset: 0;
            }
        }
        
        .slide-up {
            animation: slideUp 0.3s ease-out forwards;
        }
        
        @keyframes slideUp {
            from {
                transform: translateY(20px);
                opacity: 0;
            }
            to {
                transform: translateY(0);
                opacity: 1;
            }
        }
        
        .pulse {
            animation: pulse 2s infinite;
        }
        
        @keyframes pulse {
            0% {
                transform: scale(1);
            }
            50% {
                transform: scale(1.05);
            }
            100% {
                transform: scale(1);
            }
        }
        
        .card {
            border-radius: 1rem;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.08);
            transition: all 0.3s ease;
            overflow: hidden;
            background: white;
        }
        
        .card:hover {
            transform: translateY(-5px);
            box-shadow: 0 10px 25px rgba(0, 0, 0, 0.15);
        }
        
        .progress-bar {
            height: 8px;
            border-radius: 4px;
            overflow: hidden;
        }
        
        .progress-fill {
            height: 100%;
            background: linear-gradient(90deg, var(--primary), var(--primary-dark));
            border-radius: 4px;
            transition: width 0.5s ease;
        }
        
        .selected-vehicle {
            border: 2px solid var(--primary);
            box-shadow: 0 0 0 3px rgba(255, 140, 0, 0.2);
        }
        
        .driver-status {
            padding: 10px 15px;
            border-radius: 50px;
            font-weight: 500;
            display: inline-flex;
            align-items: center;
            gap: 8px;
        }
        
        .status-en-route {
            background-color: rgba(26, 42, 108, 0.1);
            color: var(--secondary);
        }
        
        .status-arrived {
            background-color: rgba(40, 167, 69, 0.1);
            color: var(--accent);
        }
        
        .status-in-progress {
            background-color: rgba(255, 140, 0, 0.1);
            color: var(--primary);
        }
        
        .nav-item.active {
            color: var(--primary);
            border-bottom: 3px solid var(--primary);
        }
        
        .city-marker {
            background-color: var(--secondary);
            border-radius: 50%;
            width: 12px;
            height: 12px;
            border: 2px solid white;
            box-shadow: 0 0 5px rgba(0,0,0,0.3);
        }
        
        .stat-card {
            background: rgba(26, 42, 108, 0.05);
            border-radius: 12px;
            padding: 12px;
            text-align: center;
        }
        
        .price-tag {
            background: linear-gradient(135deg, var(--primary), var(--primary-dark));
            color: white;
            padding: 3px 10px;
            border-radius: 20px;
            font-weight: 600;
            font-size: 0.9rem;
        }
    </style>
</head>
<body class="bg-gray-50 min-h-screen flex flex-col">
    <!-- Header -->
    <header class="bg-white shadow-sm sticky top-0 z-10">
        <div class="container mx-auto px-4 py-3 flex justify-between items-center">
            <div class="flex items-center">
                <div class="w-10 h-10 rounded-full bg-[#FF8C00] flex items-center justify-center text-white font-bold mr-2 shadow-md">
                    <i class="fas fa-car"></i>
                </div>
                <div>
                    <h1 class="text-xl font-bold text-[#1A2A6C]">Ivoire Ride</h1>
                    <p class="text-xs text-[#FF8C00]">Simulation VTC Côte d'Ivoire</p>
                </div>
            </div>
            <div class="flex items-center space-x-4">
                <button class="text-gray-600 hover:text-[#FF8C00] transition-colors">
                    <i class="fas fa-history"></i>
                </button>
                <button class="text-gray-600 hover:text-[#FF8C00] transition-colors">
                    <i class="fas fa-user-circle"></i>
                </button>
            </div>
        </div>
    </header>

    <!-- Main Content -->
    <main class="flex-grow container mx-auto px-4 py-6 max-w-3xl">
        <!-- Booking Steps -->
        <div class="mb-6">
            <div class="flex justify-between items-center mb-4">
                <div class="flex-1 text-center relative">
                    <div class="w-8 h-8 mx-auto rounded-full bg-[#FF8C00] text-white flex items-center justify-center font-bold shadow-md">1</div>
                    <p class="text-xs mt-1 text-[#FF8C00] font-medium">Trajet</p>
                    <div class="absolute top-4 right-0 w-1/2 h-1 bg-[#FF8C00]"></div>
                </div>
                <div class="flex-1 text-center relative">
                    <div class="w-8 h-8 mx-auto rounded-full bg-gray-300 text-gray-600 flex items-center justify-center font-bold">2</div>
                    <p class="text-xs mt-1 text-gray-500">Véhicule</p>
                    <div class="absolute top-4 left-0 w-1/2 h-1 bg-gray-300"></div>
                    <div class="absolute top-4 right-0 w-1/2 h-1 bg-gray-300"></div>
                </div>
                <div class="flex-1 text-center relative">
                    <div class="w-8 h-8 mx-auto rounded-full bg-gray-300 text-gray-600 flex items-center justify-center font-bold">3</div>
                    <p class="text-xs mt-1 text-gray-500">Course</p>
                    <div class="absolute top-4 left-0 w-1/2 h-1 bg-gray-300"></div>
                </div>
            </div>
        </div>

        <!-- Map Section -->
        <div class="card p-4 mb-6">
            <h2 class="text-lg font-semibold text-[#1A2A6C] mb-3 flex items-center gap-2">
                <i class="fas fa-map-marked-alt text-[#FF8C00]"></i>
                Définissez votre trajet
            </h2>
            <div id="map" class="mb-4"></div>
            
            <div class="grid grid-cols-2 gap-4">
                <div class="flex items-center p-3 bg-gray-50 rounded-lg">
                    <div class="w-6 h-6 rounded-full bg-[#FF8C00] mr-3 flex items-center justify-center text-white">
                        <i class="fas fa-location-arrow text-xs"></i>
                    </div>
                    <div>
                        <p class="text-sm font-medium">Point de départ</p>
                        <p id="pickup-text" class="text-xs text-gray-500">Cliquez sur la carte</p>
                    </div>
                </div>
                
                <div class="flex items-center p-3 bg-gray-50 rounded-lg">
                    <div class="w-6 h-6 rounded-full bg-[#1A2A6C] mr-3 flex items-center justify-center text-white">
                        <i class="fas fa-flag text-xs"></i>
                    </div>
                    <div>
                        <p class="text-sm font-medium">Destination</p>
                        <p id="destination-text" class="text-xs text-gray-500">Cliquez sur la carte</p>
                    </div>
                </div>
            </div>
        </div>

        <!-- Vehicle Selection -->
        <div id="vehicle-selection" class="card p-4 mb-6">
            <h2 class="text-lg font-semibold text-[#1A2A6C] mb-3 flex items-center gap-2">
                <i class="fas fa-car text-[#FF8C00]"></i>
                Choisissez votre véhicule
            </h2>
            
            <div class="grid grid-cols-1 gap-3">
                <!-- Eco Option -->
                <div class="vehicle-option border rounded-lg p-3 transition-all cursor-pointer" onclick="selectVehicle('eco')">
                    <div class="flex justify-between items-center">
                        <div class="flex items-center">
                            <div class="w-10 h-10 rounded-lg bg-blue-100 flex items-center justify-center mr-3">
                                <i class="fas fa-car text-blue-500 text-xl"></i>
                            </div>
                            <div>
                                <h3 class="font-medium">Éco</h3>
                                <p class="text-sm text-gray-500">5 min d'attente</p>
                            </div>
                        </div>
                        <div class="text-right">
                            <p class="font-bold text-[#1A2A6C]">300 FCFA/km</p>
                            <p class="text-sm text-gray-500">Prix estimé: <span id="eco-price">-</span></p>
                        </div>
                    </div>
                </div>
                
                <!-- Comfort Option -->
                <div class="vehicle-option border rounded-lg p-3 transition-all cursor-pointer" onclick="selectVehicle('comfort')">
                    <div class="flex justify-between items-center">
                        <div class="flex items-center">
                            <div class="w-10 h-10 rounded-lg bg-purple-100 flex items-center justify-center mr-3">
                                <i class="fas fa-car-side text-purple-500 text-xl"></i>
                            </div>
                            <div>
                                <h3 class="font-medium">Confort</h3>
                                <p class="text-sm text-gray-500">7 min d'attente</p>
                            </div>
                        </div>
                        <div class="text-right">
                            <p class="font-bold text-[#1A2A6C]">600 FCFA/km</p>
                            <p class="text-sm text-gray-500">Prix estimé: <span id="comfort-price">-</span></p>
                        </div>
                    </div>
                </div>
                
                <!-- Moto Option -->
                <div class="vehicle-option border rounded-lg p-3 transition-all cursor-pointer" onclick="selectVehicle('moto')">
                    <div class="flex justify-between items-center">
                        <div class="flex items-center">
                            <div class="w-10 h-10 rounded-lg bg-green-100 flex items-center justify-center mr-3">
                                <i class="fas fa-motorcycle text-green-500 text-xl"></i>
                            </div>
                            <div>
                                <h3 class="font-medium">Moto</h3>
                                <p class="text-sm text-gray-500">3 min d'attente</p>
                            </div>
                        </div>
                        <div class="text-right">
                            <p class="font-bold text-[#1A2A6C]">150 FCFA/km</p>
                            <p class="text-sm text-gray-500">Prix estimé: <span id="moto-price">-</span></p>
                        </div>
                    </div>
                </div>
            </div>
            
            <button id="confirm-vehicle" class="w-full bg-[#FF8C00] hover:bg-[#E67E00] text-white py-3 rounded-lg font-bold mt-4 transition-colors disabled:opacity-50 disabled:cursor-not-allowed" disabled>
                <i class="fas fa-check-circle mr-2"></i>Confirmer le véhicule
            </button>
        </div>

        <!-- Driver Assignment -->
        <div id="driver-assignment" class="card p-4 mb-6 hidden">
            <h2 class="text-lg font-semibold text-[#1A2A6C] mb-3 flex items-center gap-2">
                <i class="fas fa-user-tie text-[#FF8C00]"></i>
                Votre chauffeur
            </h2>
            
            <div class="flex flex-col md:flex-row gap-4 mb-4">
                <div class="flex items-center">
                    <div class="relative mr-4">
                        <img src="https://randomuser.me/api/portraits/men/32.jpg" alt="Driver" class="w-16 h-16 rounded-full border-2 border-[#FF8C00] shadow-md">
                        <div class="absolute -bottom-1 -right-1 bg-white rounded-full p-1 shadow">
                            <div class="w-6 h-6 rounded-full bg-green-500 flex items-center justify-center">
                                <i class="fas fa-check text-white text-xs"></i>
                            </div>
                        </div>
                    </div>
                    <div>
                        <h3 class="font-bold">Jean Kouassi</h3>
                        <div class="flex items-center">
                            <div class="flex text-yellow-400">
                                <i class="fas fa-star"></i>
                                <i class="fas fa-star"></i>
                                <i class="fas fa-star"></i>
                                <i class="fas fa-star"></i>
                                <i class="fas fa-star-half-alt"></i>
                            </div>
                            <span class="text-gray-600 ml-1">4.7</span>
                        </div>
                        <p class="text-sm text-gray-500">Toyota Corolla • AB 123 CD</p>
                    </div>
                </div>
                
                <div class="bg-gray-50 rounded-lg p-3 flex-1">
                    <div class="flex justify-between items-center mb-2">
                        <span class="text-gray-600">Distance</span>
                        <span class="font-medium"><span id="ride-distance">-</span> km</span>
                    </div>
                    <div class="flex justify-between items-center mb-2">
                        <span class="text-gray-600">Durée estimée</span>
                        <span class="font-medium"><span id="ride-duration">-</span> min</span>
                    </div>
                    <div class="flex justify-between items-center">
                        <span class="text-gray-600">Prix estimé</span>
                        <span class="font-bold text-[#FF8C00]"><span id="ride-price">-</span> FCFA</span>
                    </div>
                </div>
            </div>
            
            <button id="start-ride" class="w-full bg-[#FF8C00] hover:bg-[#E67E00] text-white py-3 rounded-lg font-bold transition-colors">
                <i class="fas fa-play mr-2"></i>Démarrer la course
            </button>
        </div>

        <!-- Ride Simulation -->
        <div id="ride-simulation" class="card p-4 mb-6 hidden">
            <h2 class="text-lg font-semibold text-[#1A2A6C] mb-3 flex items-center gap-2">
                <i class="fas fa-road text-[#FF8C00]"></i>
                Votre course en cours
            </h2>
            
            <div class="flex flex-col md:flex-row gap-4 mb-4">
                <div class="flex items-center">
                    <div class="relative mr-4">
                        <img src="https://randomuser.me/api/portraits/men/32.jpg" alt="Driver" class="w-16 h-16 rounded-full border-2 border-[#FF8C00] pulse">
                    </div>
                    <div>
                        <h3 class="font-bold">Jean Kouassi</h3>
                        <p class="text-sm text-gray-500">Toyota Corolla • AB 123 CD</p>
                        <div class="driver-status status-in-progress mt-1">
                            <i class="fas fa-car"></i>
                            <span>En chemin vers vous</span>
                        </div>
                    </div>
                </div>
                
                <div class="bg-gray-50 rounded-lg p-3 flex-1">
                    <div class="grid grid-cols-2 gap-2 mb-2">
                        <div>
                            <p class="text-xs text-gray-500">Distance restante</p>
                            <p id="remaining-distance" class="font-bold">- km</p>
                        </div>
                        <div>
                            <p class="text-xs text-gray-500">Temps restant</p>
                            <p id="remaining-time" class="font-bold">- min</p>
                        </div>
                    </div>
                    <div>
                        <p class="text-xs text-gray-500">Coût actuel</p>
                        <p id="current-cost" class="font-bold">- FCFA</p>
                    </div>
                </div>
            </div>
            
            <div class="mb-4">
                <div class="flex justify-between text-sm mb-1">
                    <span class="text-gray-600">Progression de la course</span>
                    <span id="progress-percent" class="font-medium">0%</span>
                </div>
                <div class="progress-bar bg-gray-200">
                    <div id="progress-fill" class="progress-fill" style="width: 0%"></div>
                </div>
            </div>
            
            <div class="bg-gray-50 rounded-lg p-3 mb-4">
                <div class="flex items-center mb-3">
                    <div class="w-4 h-4 rounded-full bg-[#FF8C00] mr-3"></div>
                    <div>
                        <p class="font-medium" id="from-location">-</p>
                        <p class="text-xs text-gray-500">Point de départ</p>
                    </div>
                </div>
                <div class="flex items-center">
                    <div class="w-4 h-4 rounded-full bg-[#1A2A6C] mr-3"></div>
                    <div>
                        <p class="font-medium" id="to-location">-</p>
                        <p class="text-xs text-gray-500">Destination</p>
                    </div>
                </div>
            </div>
            
            <div class="flex gap-3">
                <button id="cancel-ride" class="flex-1 bg-red-100 text-red-600 py-3 rounded-lg font-bold hover:bg-red-200 transition-colors">
                    <i class="fas fa-times mr-2"></i>Annuler
                </button>
                <button id="complete-ride" class="flex-1 bg-[#1A2A6C] text-white py-3 rounded-lg font-bold hover:bg-[#15225e] transition-colors hidden">
                    <i class="fas fa-flag-checkered mr-2"></i>Terminer
                </button>
            </div>
        </div>
    </main>

    <!-- Bottom Navigation -->
    <nav class="bg-white shadow-lg sticky bottom-0 z-10">
        <div class="container mx-auto px-4">
            <div class="flex justify-around">
                <button class="py-4 px-6 text-[#FF8C00] border-b-2 border-[#FF8C00] nav-item active">
                    <i class="fas fa-home text-xl"></i>
                    <p class="text-xs mt-1">Accueil</p>
                </button>
                <button class="py-4 px-6 text-gray-500 hover:text-[#1A2A6C] nav-item">
                    <i class="fas fa-search text-xl"></i>
                    <p class="text-xs mt-1">Rechercher</p>
                </button>
                <button class="py-4 px-6 text-gray-500 hover:text-[#1A2A6C] nav-item">
                    <i class="fas fa-history text-xl"></i>
                    <p class="text-xs mt-1">Historique</p>
                </button>
                <button class="py-4 px-6 text-gray-500 hover:text-[#1A2A6C] nav-item">
                    <i class="fas fa-user text-xl"></i>
                    <p class="text-xs mt-1">Profil</p>
                </button>
            </div>
        </div>
    </nav>

    <script>
        // Configuration des villes et lieux
        const cities = [
            { name: "Abidjan", coords: [5.3599, -4.0083], places: [
                { name: "Plateau (Centre-ville)", coords: [5.3197, -4.0186] },
                { name: "Yopougon", coords: [5.3356, -4.0775] },
                { name: "Cocody", coords: [5.3606, -3.9872] },
                { name: "Marcory", coords: [5.3058, -3.9994] }
            ]},
            { name: "Yamoussoukro", coords: [6.8276, -5.2893], places: [
                { name: "Basilique Notre-Dame", coords: [6.8111, -5.2933] },
                { name: "Palais Présidentiel", coords: [6.8058, -5.2767] }
            ]},
            { name: "Bouaké", coords: [7.6906, -5.0301], places: [
                { name: "Centre Ville", coords: [7.6894, -5.0261] },
                { name: "Gare Routière", coords: [7.6983, -5.0325] }
            ]}
        ];

        // Variables d'état
        let map, pickupMarker, destinationMarker, routeLine, vehicleMarker;
        let selectedPickup = null;
        let selectedDestination = null;
        let selectedVehicle = null;
        let rideInterval;
        let progress = 0;
        let distance = 0;
        let duration = 0;
        let price = 0;

        // Initialisation de la carte
        function initMap() {
            map = L.map('map').setView([5.3599, -4.0083], 12);
            
            L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
                attribution: '&copy; <a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a> contributors'
            }).addTo(map);
            
            // Ajout des villes principales
            cities.forEach(city => {
                L.marker(city.coords, {
                    icon: L.divIcon({
                        className: 'city-marker',
                        html: '<div class="city-marker"></div>',
                        iconSize: [16, 16]
                    })
                }).addTo(map).bindPopup(`<b>${city.name}</b>`);
            });
            
            // Ajout des lieux pour Abidjan
            cities[0].places.forEach(place => {
                L.marker(place.coords).addTo(map).bindPopup(`<b>${place.name}</b><br>Abidjan`);
            });
            
            // Gestion des clics sur la carte
            map.on('click', function(e) {
                if (!selectedPickup && !selectedDestination) {
                    setPickupLocation(e.latlng);
                } else if (selectedPickup && !selectedDestination) {
                    setDestinationLocation(e.latlng);
                }
            });
        }
        
        // Définir le point de départ
        function setPickupLocation(latlng) {
            selectedPickup = latlng;
            
            if (pickupMarker) map.removeLayer(pickupMarker);
            
            pickupMarker = L.marker(latlng, {
                icon: L.divIcon({
                    className: 'vehicle-marker',
                    html: '<i class="fas fa-map-marker-alt"></i>',
                    iconSize: [24, 24]
                })
            }).addTo(map).bindPopup("Point de départ");
            
            // Trouver le lieu le plus proche
            const nearestPlace = findNearestPlace(latlng);
            document.getElementById('pickup-text').textContent = nearestPlace;
            
            // Afficher la sélection véhicule
            document.getElementById('vehicle-selection').classList.add('slide-up');
            
            // Calculer les prix si la destination est déjà définie
            if (selectedDestination) {
                calculatePrices();
            }
        }
        
        // Définir la destination
        function setDestinationLocation(latlng) {
            selectedDestination = latlng;
            
            if (destinationMarker) map.removeLayer(destinationMarker);
            
            destinationMarker = L.marker(latlng, {
                icon: L.divIcon({
                    className: 'vehicle-marker',
                    html: '<i class="fas fa-flag"></i>',
                    iconSize: [24, 24]
                })
            }).addTo(map).bindPopup("Destination");
            
            // Trouver le lieu le plus proche
            const nearestPlace = findNearestPlace(latlng);
            document.getElementById('destination-text').textContent = nearestPlace;
            
            // Calculer les prix
            calculatePrices();
            
            // Centrer la carte sur les deux points
            const bounds = L.latLngBounds([selectedPickup, selectedDestination]);
            map.fitBounds(bounds, { padding: [50, 50] });
            
            // Dessiner la route
            drawRoute();
        }
        
        // Trouver le lieu le plus proche
        function findNearestPlace(latlng) {
            let nearestPlace = "Position personnalisée";
            let minDistance = Infinity;
            
            cities.forEach(city => {
                city.places.forEach(place => {
                    const distance = map.distance(latlng, place.coords);
                    if (distance < minDistance && distance < 5000) { // 5km
                        minDistance = distance;
                        nearestPlace = place.name;
                    }
                });
            });
            
            return nearestPlace;
        }
        
        // Dessiner l'itinéraire
        function drawRoute() {
            if (routeLine) map.removeLayer(routeLine);
            
            routeLine = L.polyline([selectedPickup, selectedDestination], {
                color: '#1A2A6C',
                weight: 4,
                dashArray: '10, 10'
            }).addTo(map);
            
            // Ajouter un marqueur de véhicule
            if (vehicleMarker) map.removeLayer(vehicleMarker);
            vehicleMarker = L.marker(selectedPickup, {
                icon: L.divIcon({
                    className: 'vehicle-marker',
                    html: '<i class="fas fa-car"></i>',
                    iconSize: [24, 24]
                })
            }).addTo(map).bindPopup("Votre véhicule");
        }
        
        // Calculer les prix estimés
        function calculatePrices() {
            // Calculer la distance
            distance = map.distance(selectedPickup, selectedDestination) / 1000; // en km
            duration = Math.round(distance * 3); // estimation simplifiée
            
            // Mettre à jour les prix
            document.getElementById('eco-price').textContent = Math.round(distance * 300).toLocaleString() + ' FCFA';
            document.getElementById('comfort-price').textContent = Math.round(distance * 600).toLocaleString() + ' FCFA';
            document.getElementById('moto-price').textContent = Math.round(distance * 150).toLocaleString() + ' FCFA';
            
            // Activer le bouton de confirmation
            document.getElementById('confirm-vehicle').disabled = false;
        }
        
        // Sélectionner un véhicule
        function selectVehicle(type) {
            selectedVehicle = type;
            
            // Mettre à jour l'UI
            document.querySelectorAll('.vehicle-option').forEach(el => {
                el.classList.remove('selected-vehicle');
            });
            event.currentTarget.classList.add('selected-vehicle');
        }
        
        // Confirmer le véhicule
        document.getElementById('confirm-vehicle').addEventListener('click', function() {
            // Calculer le prix
            let rate = 0;
            switch(selectedVehicle) {
                case 'eco': rate = 300; break;
                case 'comfort': rate = 600; break;
                case 'moto': rate = 150; break;
            }
            price = Math.round(distance * rate);
            
            // Mettre à jour l'affichage
            document.getElementById('ride-distance').textContent = distance.toFixed(1);
            document.getElementById('ride-duration').textContent = duration;
            document.getElementById('ride-price').textContent = price.toLocaleString();
            
            // Afficher la section chauffeur
            document.getElementById('vehicle-selection').classList.add('hidden');
            document.getElementById('driver-assignment').classList.remove('hidden');
            document.getElementById('driver-assignment').classList.add('slide-up');
        });
        
        // Démarrer la course
        document.getElementById('start-ride').addEventListener('click', function() {
            // Mettre à jour l'affichage
            document.getElementById('driver-assignment').classList.add('hidden');
            document.getElementById('ride-simulation').classList.remove('hidden');
            document.getElementById('ride-simulation').classList.add('slide-up');
            
            // Mettre à jour les lieux
            document.getElementById('from-location').textContent = document.getElementById('pickup-text').textContent;
            document.getElementById('to-location').textContent = document.getElementById('destination-text').textContent;
            
            // Démarrer la simulation
            simulateRide();
        });
        
        // Simuler la course
        function simulateRide() {
            progress = 0;
            let currentDistance = distance;
            let currentTime = duration;
            let currentPrice = 0;
            let driverStatus = 0; // 0: en chemin, 1: course en cours, 2: arrivé
            
            // Mettre à jour les informations initiales
            updateRideInfo(progress, currentDistance, currentTime, currentPrice, driverStatus);
            
            rideInterval = setInterval(() => {
                progress += 1;
                
                if (progress >= 100) {
                    clearInterval(rideInterval);
                    progress = 100;
                    driverStatus = 2;
                    document.getElementById('complete-ride').classList.remove('hidden');
                    
                    // Mettre à jour le statut
                    document.querySelector('.driver-status').innerHTML = '<i class="fas fa-check-circle"></i> Arrivé à destination';
                    document.querySelector('.driver-status').className = 'driver-status status-arrived';
                } else if (progress >= 30 && driverStatus === 0) {
                    driverStatus = 1;
                    document.querySelector('.driver-status').innerHTML = '<i class="fas fa-running"></i> Course en cours';
                    document.querySelector('.driver-status').className = 'driver-status status-in-progress';
                }
                
                currentDistance = (distance - (distance * progress / 100)).toFixed(1);
                currentTime = Math.max(1, Math.floor(duration - (duration * progress / 100)));
                currentPrice = Math.floor(price * progress / 100);
                
                // Mettre à jour les informations
                updateRideInfo(progress, currentDistance, currentTime, currentPrice, driverStatus);
                
                // Mettre à jour la position du véhicule
                updateVehiclePosition(progress);
                
            }, 150);
        }
        
        // Mettre à jour les informations de la course
        function updateRideInfo(progress, distance, time, price, status) {
            document.getElementById('progress-fill').style.width = `${progress}%`;
            document.getElementById('progress-percent').textContent = `${progress}%`;
            document.getElementById('remaining-distance').textContent = `${distance} km`;
            document.getElementById('remaining-time').textContent = `${time} min`;
            document.getElementById('current-cost').textContent = `${price.toLocaleString()} FCFA`;
        }
        
        // Mettre à jour la position du véhicule
        function updateVehiclePosition(progress) {
            const lat = selectedPickup.lat + ((selectedDestination.lat - selectedPickup.lat) * progress / 100);
            const lng = selectedPickup.lng + ((selectedDestination.lng - selectedPickup.lng) * progress / 100);
            vehicleMarker.setLatLng([lat, lng]);
        }
        
        // Annuler la course
        document.getElementById('cancel-ride').addEventListener('click', function() {
            clearInterval(rideInterval);
            document.getElementById('ride-simulation').classList.add('hidden');
            document.getElementById('vehicle-selection').classList.remove('hidden');
            
            // Réinitialiser
            progress = 0;
            document.getElementById('progress-fill').style.width = '0%';
            document.getElementById('progress-percent').textContent = '0%';
            document.getElementById('complete-ride').classList.add('hidden');
            
            // Réinitialiser le statut
            document.querySelector('.driver-status').innerHTML = '<i class="fas fa-car"></i> En chemin vers vous';
            document.querySelector('.driver-status').className = 'driver-status status-in-progress';
        });
        
        // Terminer la course
        document.getElementById('complete-ride').addEventListener('click', function() {
            clearInterval(rideInterval);
            document.getElementById('ride-simulation').classList.add('hidden');
            
            // Réinitialiser la carte
            map.removeLayer(pickupMarker);
            map.removeLayer(destinationMarker);
            map.removeLayer(routeLine);
            map.removeLayer(vehicleMarker);
            
            // Réinitialiser les sélections
            selectedPickup = null;
            selectedDestination = null;
            selectedVehicle = null;
            
            // Réinitialiser les textes
            document.getElementById('pickup-text').textContent = 'Cliquez sur la carte';
            document.getElementById('destination-text').textContent = 'Cliquez sur la carte';
            
            // Réinitialiser les prix
            document.getElementById('eco-price').textContent = '-';
            document.getElementById('comfort-price').textContent = '-';
            document.getElementById('moto-price').textContent = '-';
            
            // Désactiver le bouton de confirmation
            document.getElementById('confirm-vehicle').disabled = true;
            
            // Réinitialiser les sélections de véhicule
            document.querySelectorAll('.vehicle-option').forEach(el => {
                el.classList.remove('selected-vehicle');
            });
            
            // Réinitialiser le statut
            document.querySelector('.driver-status').innerHTML = '<i class="fas fa-car"></i> En chemin vers vous';
            document.querySelector('.driver-status').className = 'driver-status status-in-progress';
            
            // Recentrer la carte
            map.setView([5.3599, -4.0083], 12);
        });
        
        // Initialiser la carte au chargement
        window.addEventListener('DOMContentLoaded', initMap);
    </script>
</body>
</html>
